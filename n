#!/bin/sed -f


s/\([^0-9]*\)0\+ *+ *0\+\([^0-9]*\)/\10\2/g

/[0-9] *+ *[0-9]/ {
  
  h

  s/[^0-9]*\([0-9]*\) *+ *\([0-9]*\)[^0-9]*/\1 \2/

  s/\([0-9][0-9]*\) \([0-9]\)/,\1 \2/

  :zpet

  s/,\([0-9]*\)\([0-9]\) \([0-9]*\)\([0-9]\)/\2\4,\1 \3/   #cisla stejne dlouhe

  t zpet

  s/\([0-9]*\),/\1/

  s/\([0-9][0-9]\)\([0-9]*\)/,0\1:\2/

  :zp

  :nah

    s/,\(.*\)1\(.*\):/,\1X\2:/
    s/,\(.*\)2\(.*\):/,\1XX\2:/
    s/,\(.*\)3\(.*\):/,\1XXX\2:/
    s/,\(.*\)4\(.*\):/,\1XXXX\2:/
    s/,\(.*\)5\(.*\):/,\1XXXXX\2:/
    s/,\(.*\)6\(.*\):/,\1XXXXXX\2:/
    s/,\(.*\)7\(.*\):/,\1XXXXXXX\2:/
    s/,\(.*\)8\(.*\):/,\1XXXXXXXX\2:/
    s/,\(.*\)9\(.*\):/,\1XXXXXXXXX\2:/
    s/,\(.*\)0\(.*\):/,\1\2:/
  
  t nah

  s/,XXXXXXXXXX:/,01:/
  s/,\(X*\)XXXXXXXXXX:/,\11:/  
  s/,\(X\{1,9\}\):/,\10:/       

  s/XXXXXXXXX/9/
  s/XXXXXXXX/8/
  s/XXXXXXX/7/
  s/XXXXXX/6/
  s/XXXXX/5/
  s/XXXX/4/
  s/XXX/3/
  s/XX/2/
  s/X/1/

  /:[0-9][0-9]*/ { s/\([0-9]*\),\([0-9]\)\([0-9]\):\([0-9][0-9]\)/\2\1,\3\4:/ }

  /1:[^0-9]/ { s/\([0-9]*\),\([0-9]\)1:/1\2\1/ }

  /0:[^0-9]/ { s/\([0-9]*\),\([0-9]\)0:/\2\1/ }

  t zp

  s/.*/&,/
  G
  s/\([0-9]*\),\([^0-9]*\)[0-9]\+ *+ *[0-9]\+/\2\1/  

}



